<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>우리집 일상선택</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

        :root {
            --main-color: #235135;
            /* 진한 초록색 */
            --light-color: #e9f2ef;
            /* 연한 민트색 */
            --accent-color: #5a8f7b;
            /* 중간 초록색 */
            --border-color: #cccccc;
            /* 회색 */
            --button-color: #ededed;
            /* 연한 회색 */
            --card-back-gradient: linear-gradient(135deg, var(--main-color), var(--accent-color));
            --text-dark: #333333;
            --text-light: #ffffff;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, var(--light-color) 0%, #ffffff 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.625rem 0;
            animation: fadeIn 0.5s ease-in-out;
            opacity: 1;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        .fade-out {
            animation: fadeOut 0.5s ease-in-out forwards;
            pointer-events: none;
        }

        h1 {
            color: var(--main-color);
            margin-bottom: 0.625rem;
            font-size: 2.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        h1::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 100%;
            height: 0.1875rem;
            background: linear-gradient(90deg, var(--main-color), var(--accent-color), var(--light-color));
            animation: gradient 3s ease infinite;
            background-size: 200% 200%;
        }

        @keyframes gradient {
            0% {
                background-position: 0% 50%
            }

            50% {
                background-position: 100% 50%
            }

            100% {
                background-position: 0% 50%
            }
        }

        .member-info {
            background: white;
            border-radius: 0.9375rem;
            padding: 0.5rem;
            margin: 0 auto 0.5rem;
            box-shadow: 0 0.3125rem 0.9375rem var(--shadow-color);
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            align-items: stretch;
            justify-content: space-between;
            gap: 2rem;
            width: 80%;
            max-width: 80%;
            border: 1px solid var(--light-color);
        }

        .member-info-text {
            min-width: 12.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            flex: 1;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 0.5rem;
        }

        .member-name {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--main-color);
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 0.625rem;
            flex-wrap: wrap;
            text-align: center;
            width: 100%;
        }

        .greeting {
            font-size: 1rem;
            font-weight: 500;
            color: var(--accent-color);
            text-align: center;
        }

        .member-details {
            font-size: 0.9rem;
            color: #666;
            text-align: center;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            margin-bottom: 10px;
        }

        .member-number,
        .member-birth {
            display: block;
            width: 100%;
            text-align: center;
        }

        .change-member-btn {
            padding: 0.5rem 0.9375rem;
            background: var(--button-color);
            border: 1px solid var(--border-color);
            border-radius: 0.3125rem;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            white-space: nowrap;
            color: var(--text-dark);
            margin-top: 0.5rem;
        }

        .change-member-btn:hover {
            background: var(--light-color);
            border-color: var(--accent-color);
            color: var(--main-color);
        }

        .date-selector {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            flex: 1;
            padding: 0.5rem;
        }

        .date-label {
            color: var(--main-color);
            font-weight: 500;
            font-size: 0.9rem;
            margin-right: 0.5rem;
            display: flex;
            flex-wrap: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .date-input {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.3125rem;
            font-size: 0.9rem;
            color: var(--text-dark);
            background-color: white;
            width: 10rem;
        }

        .date-input:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 0.125rem rgba(90, 143, 123, 0.2);
        }

        .products-container.all-visible {
            max-width: 100%;
            position: relative;
            min-height: 18.75rem;
            width: 100%;
        }

        .product-card {
            width: 270px;
            height: 350px;
            background-color: white;
            border-radius: 0.9375rem;
            position: relative;
            transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            transform-style: preserve-3d;
            perspective: 62.5rem;
            border: 1px solid var(--light-color);
            box-shadow: 0 0.3125rem 0.9375rem var(--shadow-color);
        }

        .product-card:hover {
            transform: translateY(-0.9375rem) rotateY(5deg);
            box-shadow: 0 0.9375rem 1.875rem rgba(35, 81, 53, 0.15);
            border-color: var(--accent-color);
        }

        .product-card.inactive {
            opacity: 1;
            transform: scale(0.95);
            filter: none;
            pointer-events: none;
            transition: opacity 0.8s ease, transform 0.8s ease;
        }

        .product-card.active {
            transform: rotateY(180deg) translate(-50%, -50%) scale(2.0);
            position: fixed;
            z-index: 999;
            box-shadow: 0 1.875rem 3.125rem rgba(35, 81, 53, 0.2);
            top: 50%;
            left: 50%;
            transition: all 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @media (max-width: 768px) {
            .product-card.active {
                transform: rotateY(180deg);
                position: relative;
                top: auto;
                left: auto;
                margin-top: 0;
                scale: 1;
            }
        }

        .card-front,
        .card-back {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            backface-visibility: hidden;
            border-radius: 0.9375rem;
            overflow: hidden;
            box-shadow: 0 0.625rem 1.25rem rgba(0, 0, 0, 0.1);
        }

        .card-back {
            background: var(--card-back-gradient);
            transform: rotateY(180deg);
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            color: white;
            opacity: 1;
            position: relative;
            background-image: url('https://newsimg.hankookilbo.com/cms/articlerelease/2021/02/05/6e089997-44db-4f18-97dd-ee337f9a5810.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 0.9375rem;
        }

        .card-back::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 1;
            border-radius: 0.9375rem;
        }

        .card-back h3,
        .card-back p,
        .card-back button {
            position: relative;
            z-index: 2;
        }

        .product-image {
            height: 10rem;
            overflow: hidden;
            position: relative;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.7s ease;
        }

        .product-card:hover .product-image img {
            transform: scale(1.1);
        }

        .product-info {
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .product-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--main-color);
            flex-grow: 0;
        }

        .product-instructor {
            font-size: 0.9rem;
            color: var(--accent-color);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .product-description {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.9375rem;
            display: -webkit-box;
            /* -webkit-line-clamp: 4; */
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            max-height: none;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 0 0.5rem;
        }

        .product-price {
            font-size: 1rem;
            font-weight: 700;
            color: var(--accent-color);
        }

        .ribbon {
            position: absolute;
            top: 0.9375rem;
            right: -1.875rem;
            width: 9.375rem;
            height: 1.875rem;
            background-color: var(--main-color);
            color: white;
            text-align: center;
            font-size: 0.9rem;
            line-height: 1.875rem;
            font-weight: 700;
            transform: rotate(45deg);
            z-index: 10;
            box-shadow: 0 0.3125rem 0.625rem rgba(35, 81, 53, 0.2);
        }

        .card-back h3 {
            font-size: 1.2rem;
            margin-bottom: 0.2rem;
            text-align: center;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
            color: white;
        }

        .card-back p {
            font-size: 0.9rem;
            line-height: 1.5;
            text-align: center;
            margin-bottom: 0;
            color: rgba(255, 255, 255, 0.9);
        }

        .card-back button {
            padding: 0.625rem 1.5625rem;
            background: white;
            color: var(--main-color);
            border: none;
            border-radius: 3.125rem;
            font-weight: 700;
            cursor: pointer;
            align-self: center;
            transition: all 0.3s ease;
            margin-top: auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .card-back button:hover {
            background: var(--light-color);
            color: var(--main-color);
            transform: translateY(-0.3125rem);
            box-shadow: 0 0.3125rem 0.9375rem rgba(255, 255, 255, 0.2);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .modal.active {
            visibility: visible;
            opacity: 1;
        }

        .modal-content {
            width: 80%;
            max-width: 500px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            transform: scale(0.8);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #f5f5f5;
            border-bottom: 1px solid #ddd;
        }
        
        .modal-close {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-info {
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #333;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .apply-button {
            padding: 10px 20px;
            background: #2196f3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .cancel-button {
            padding: 10px 20px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        
        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #2196f3;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .success-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #4caf50;
            color: white;
            padding: 15px 30px;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .success-message.show {
            opacity: 1;
        }

        /* 신청한 클래스 표시 영역 스타일 */
        .applied-classes {
            flex: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            min-width: 0;
        }

        .applied-classes-title {
            font-size: 0.9rem;
            font-weight: 500;
            color: #555;
            margin-bottom: 5px;
            text-align: center;
        }

        .applied-class-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
            width: 100%;
            max-width: 500px;
        }

        .applied-class-tag {
            background-color: var(--light-color);
            color: var(--main-color);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            box-shadow: 0 1px 3px var(--shadow-color);
            transition: all 0.2s ease;
            border: 1px solid rgba(90, 143, 123, 0.2);
            white-space: nowrap;
            max-width: 100%;
            overflow: hidden;
        }

        .applied-class-tag-time {
            color: var(--main-color);
            font-weight: 500;
            margin-right: 5px;
            flex-shrink: 0;
        }

        .applied-class-tag-title {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
            min-width: 0;
        }

        .applied-class-tag-delete {
            margin-left: 5px;
            color: #f44336;
            font-weight: bold;
            cursor: pointer;
            font-size: 1rem;
            line-height: 0.7;
            opacity: 0.7;
            flex-shrink: 0;
        }

        .applied-class-tag:hover {
            background-color: #d7e9e3;
            box-shadow: 0 2px 5px var(--shadow-color);
        }

        .applied-class-tag-delete:hover {
            opacity: 1;
        }

        .empty-applied {
            font-size: 0.85rem;
            color: #757575;
            font-style: italic;
        }

        .time-section-title {
            width: 100%;
            margin: 30px 0 15px 0;
            color: var(--main-color);
            font-size: 1.5rem;
            font-weight: 700;
            border-left: 5px solid var(--accent-color);
            padding-left: 15px;
            position: relative;
            max-width: 1360px;
            margin-left: auto;
            margin-right: auto;
        }

        .time-section-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100px;
            height: 2px;
            background: var(--accent-color);
        }

        /* 필터 버튼 스타일 */
        .filter-container {
            width: 100%;
            max-width: 800px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-button {
            padding: 8px 15px;
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 25px;
            color: var(--text-dark);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .filter-button:hover {
            background-color: var(--light-color);
            transform: translateY(-2px);
            box-shadow: 0 3px 5px var(--shadow-color);
            border-color: var(--accent-color);
        }

        .filter-button.active {
            background-color: var(--main-color);
            color: white;
            border-color: var(--main-color);
            box-shadow: 0 3px 8px rgba(35, 81, 53, 0.3);
        }

        /* 시간대 섹션 컨테이너 */
        .time-section {
            width: 100%;
            display: none;
            /* 기본적으로 모든 섹션 숨김 */
            max-width: 100%;
            margin: 0 auto;
        }

        .time-section.visible {
            display: block;
            /* 필터링된 섹션만 표시 */
        }

        /* 모든 클래스 보기 */
        .all-visible .time-section {
            display: block;
            /* 모든 섹션 표시 */
        }

        /* 카드 컨테이너 */
        .cards-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-evenly;
            gap: 15px;
            width: 100%;
            margin: 0 3px;
            padding: 0;
            max-width: 100%;
        }

        /* 반응형 미디어 쿼리 */
        /* 기본 스타일 (768px 초과) */
        .product-card {
            width: 270px;
            height: 350px;
        }

        .product-image {
            height: 160px;
        }

        .product-title {
            font-size: 1.1rem;
        }

        /* 중간 화면 (768px 이하) */
        @media (max-width: 768px) {
            .cards-container {
                max-width: 570px;
            }

            .product-card {
                width: 220px;
                height: 320px;
            }

            .product-image {
                height: 140px;
            }

            .product-title {
                font-size: 1rem;
            }

            .member-info {
                flex-direction: column;
                align-items: stretch;
                padding: 1rem;
            }

            .member-info-text,
            .applied-classes,
            .date-selector {
                width: 100%;
                flex: 0 0 auto;
                padding: 0.5rem;
                justify-content: center;
                align-items: center;
            }

            .applied-classes {
                margin: 1rem 0;
                order: 3;
            }

            .date-selector {
                flex-direction: row;
                justify-content: center;
                align-items: center;
                width: 100%;
                order: 2;
            }

            .date-input {
                width: auto;
                flex: 1;
                max-width: 150px;
                margin-right: 10px;
            }
        }

        /* 소형 화면 (482px 이하) */
        @media (max-width: 482px) {
            .cards-container {
                max-width: 100%;
                justify-content: center;
            }

            .product-card {
                width: 80%;
                height: 350px;
                margin: 0 auto;
            }

            .product-image {
                height: 160px;
            }

            .member-info {
                padding: 0.8rem;
            }

            .member-info-text,
            .applied-classes,
            .date-selector {
                width: 100%;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                text-align: center;
            }

            .member-name {
                flex-direction: column;
                align-items: center;
                justify-content: center;
                text-align: center;
                white-space: normal;
            }

            .greeting {
                margin-top: 0.2rem;
            }

            .applied-class-tags {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                width: 100%;
                justify-content: center;
            }

            .applied-class-tag,
            .member-details {
                white-space: normal;
                text-align: center;
                word-break: keep-all;
            }

            .filter-container {
                gap: 8px;
            }

            .filter-button {
                padding: 6px 12px;
                font-size: 0.85rem;
            }

            .date-selector {
                flex-direction: column;
            }

            .date-input {
                width: 100%;
                max-width: none;
                margin-right: 0;
                margin-bottom: 10px;
            }

            .change-member-btn {
                width: 100%;
                text-align: center;
            }
        }

        /* 최종 확인 모달 */
        .final-confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .final-confirm-modal.active {
            visibility: visible;
            opacity: 1;
        }

        .final-modal-content {
            width: 90%;
            max-width: 600px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            transform: scale(0.8);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .final-confirm-modal.active .final-modal-content {
            transform: scale(1);
        }

        .final-modal-header {
            background: #2196f3;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .final-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
        }

        .final-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            color: white;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.2s ease;
        }

        .final-modal-close:hover {
            opacity: 1;
        }

        .final-modal-body {
            padding: 25px;
        }

        .final-modal-classes {
            background: #f5f5f5;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            max-height: 250px;
            overflow-y: auto;
        }

        .final-class-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .final-class-time {
            background: #2196f3;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 500;
            margin-right: 15px;
            min-width: 40px;
            text-align: center;
        }

        .final-class-info {
            flex: 1;
        }

        .final-class-title {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .final-class-instructor {
            font-size: 0.8rem;
            color: #666;
        }

        .final-modal-buttons {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 20px;
        }

        .final-confirm-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .final-confirm-btn.submit {
            background: #4caf50;
            color: white;
        }

        .final-confirm-btn.cancel {
            background: #f5f5f5;
            border: 1px solid #ddd;
            color: #333;
        }

        .final-confirm-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }

        .final-confirm-btn.submit:hover {
            background: #43a047;
        }

        .final-confirm-btn.cancel:hover {
            background: #e0e0e0;
        }

        /* 모든 클래스 완료 확인 모달 - 완전히 새로운 스타일 */
        .complete-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: all 0.4s ease;
            backdrop-filter: blur(3px);
        }

        .complete-modal-overlay.show {
            visibility: visible;
            opacity: 1;
        }

        .complete-modal-container {
            width: 90%;
            max-width: 550px;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            transform: translateY(30px) scale(0.95);
            transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        .complete-modal-overlay.show .complete-modal-container {
            transform: translateY(0) scale(1);
        }

        .complete-modal-header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 25px 30px 20px;
            position: relative;
        }

        .complete-modal-title {
            font-size: 1.6rem;
            font-weight: 700;
            margin: 0 0 10px 0;
        }

        .complete-modal-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 400;
        }

        .complete-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .complete-modal-close:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: rotate(90deg);
        }

        .complete-modal-close span {
            color: white;
            font-size: 20px;
            line-height: 1;
        }

        .complete-modal-body {
            padding: 30px;
        }

        .complete-modal-message {
            margin-bottom: 25px;
            font-size: 1.1rem;
            line-height: 1.5;
            color: #444;
        }

        .complete-classes-list {
            background: #f7f9fc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            max-height: 500px;
            /* 높이 증가 */
            overflow-y: auto;
            border: 1px solid #e9effd;
        }

        .complete-class-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }

        .complete-class-item:last-child {
            margin-bottom: 0;
        }

        .complete-class-item:hover {
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .complete-class-badge {
            flex-shrink: 0;
            background: #6a11cb;
            color: white;
            padding: 5px 12px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            margin-right: 15px;
            min-width: 40px;
            text-align: center;
        }

        .complete-class-content {
            flex: 1;
        }

        .complete-class-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 3px;
        }

        .complete-class-instructor {
            font-size: 0.85rem;
            color: #666;
        }

        .complete-modal-actions {
            display: flex;
            gap: 15px;
        }

        .complete-modal-btn {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .complete-modal-btn-primary {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(106, 17, 203, 0.2);
        }

        .complete-modal-btn-primary:hover {
            box-shadow: 0 6px 18px rgba(106, 17, 203, 0.35);
            transform: translateY(-3px);
        }

        .complete-modal-btn-secondary {
            background: #f1f4f9;
            color: #444;
            border: 1px solid #e0e6f0;
        }

        .complete-modal-btn-secondary:hover {
            background: #e5eaf2;
            transform: translateY(-3px);
        }

        /* 카드 오버레이 스타일 추가 */
        .card-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 998;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .card-overlay.active {
            display: block;
            opacity: 1;
        }
    </style>
</head>

<body>
    <h1>우리집 일상선택</h1>
    
    <div class="member-info" id="member-info">
        <div class="member-info-text">
            <div class="member-name" id="member-name">-</div>
            <div class="member-details" id="member-details">회원번호: -, 생년월일: -</div>
            <button class="change-member-btn" id="change-member-btn">회원 변경</button>
        </div>
        <!-- 신청한 클래스 표시 영역 -->
        <div class="applied-classes">
            <div class="applied-classes-title">신청한 클래스:</div>
            <div class="applied-class-tags" id="applied-class-tags">
                <span class="empty-applied">아직 신청한 클래스가 없습니다.</span>
                <!-- 신청한 클래스 태그가 여기에 추가됩니다 -->
            </div>
        </div>
        <div class="date-selector">
            <span class="date-label">조회날짜:</span>
            <input type="date" id="date-input" class="date-input">
        </div>
    </div>
    
    <!-- 필터 버튼 추가 -->
    <div class="filter-container">
        <button class="filter-button active" data-filter="all">전체 클래스</button>
        <button class="filter-button" data-filter="class1">1차 클래스</button>
        <button class="filter-button" data-filter="class2">2차 클래스</button>
        <button class="filter-button" data-filter="class3">3차 클래스</button>
        <button class="filter-button" data-filter="class4">4차 클래스</button>
        <button class="filter-button" data-filter="class5">5차 클래스</button>
    </div>

    <div class="products-container all-visible" id="products-container">
        <!-- 활동 카드는 스크립트에서 동적으로 생성됩니다 -->
    </div>
    
    <!-- 확인 모달 -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">신청 확인</h2>
                <span class="modal-close" id="modal-close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="modal-info">
                    <p><strong>회원:</strong> <span id="confirm-member-name">-</span></p>
                    <p><strong>활동:</strong> <span id="confirm-activity-name">-</span></p>
                    <p><strong>시간:</strong> <span id="confirm-time">-</span></p>
                    <p><strong>담당자:</strong> <span id="confirm-instructor">-</span></p>
                </div>
                <p>위 활동을 신청하시겠습니까?</p>
                <div class="modal-buttons">
                    <button id="apply-button" class="apply-button">신청하기</button>
                    <button id="cancel-button" class="cancel-button">취소</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 로딩 표시 -->
    <div id="loading" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>데이터 로딩 중...</p>
    </div>

    <!-- 성공 메시지 -->
    <div id="success-message" class="success-message">
        신청이 완료되었습니다!
    </div>

    <!-- 모든 클래스 완료 확인 모달 - 완전히 새로운 스타일 -->
    <div id="complete-modal-overlay" class="complete-modal-overlay">
        <div id="complete-modal-container" class="complete-modal-container">
            <div id="complete-modal-header" class="complete-modal-header">
                <h2 id="complete-modal-title" class="complete-modal-title">신청 내역 확인</h2>
                <div id="complete-modal-subtitle" class="complete-modal-subtitle">활동 신청을 완료하시겠습니까?</div>
                <div id="complete-modal-close" class="complete-modal-close">
                    <span>&times;</span>
                </div>
            </div>
            <div id="complete-modal-body" class="complete-modal-body">
                <p id="complete-modal-message" class="complete-modal-message">
                    모든 활동 신청이 완료되었습니다. 아래 신청 내역을 확인해주세요.
                </p>
                <div id="complete-classes-list" class="complete-classes-list">
                    <!-- 신청한 클래스 항목이 여기에 추가됩니다 -->
                </div>
                <div id="complete-modal-actions" class="complete-modal-actions">
                    <button id="complete-modal-btn-primary" class="complete-modal-btn complete-modal-btn-primary">신청
                        완료</button>
                    <button id="complete-modal-btn-secondary" class="complete-modal-btn complete-modal-btn-secondary">계속
                        선택하기</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수들
        let selectedMember = null;
        let selectedActivity = null;
        let appliedClasses = []; // 신청한 클래스 배열
        let selectedDate = new Date(); // 선택된 날짜

        // 시간대 관리를 위한 전역 설정
        const CLASS_TIMES = {
            // 시작 시간 (HHMM 형식)
            START: [900, 1030, 1300, 1430, 1600],
            // 종료 시간 (HHMM 형식)
            END: [1030, 1200, 1430, 1600, 1730],
            // 차수 레이블
            LABELS: ['1차', '2차', '3차', '4차', '5차'],
            // 시간대 타이틀 (UI 표시용)
            TITLES: [
                '1차 클래스 (09:00 - 10:30)',
                '2차 클래스 (10:30 - 12:00)',
                '3차 클래스 (13:00 - 14:30)',
                '4차 클래스 (14:30 - 16:00)',
                '5차 클래스 (16:00 - 17:30)'
            ],
            // 특정 시간이 어느 차수에 속하는지 확인
            getClassIndex: function (time) {
                const timeNum = parseInt(time);
                for (let i = 0; i < this.START.length; i++) {
                    if (timeNum >= this.START[i] && timeNum < this.END[i]) {
                        return i;
                    }
                }
                return -1; // 해당 없음
            },
            // 차수 번호로 레이블 가져오기 (0부터 시작)
            getLabel: function (index) {
                return (index >= 0 && index < this.LABELS.length) ? this.LABELS[index] : '기타';
            },
            // 시간으로 레이블 가져오기
            getLabelByTime: function (time) {
                const index = this.getClassIndex(time);
                return this.getLabel(index);
            },
            // 시간 형식 변환 (HHMM -> HH:MM)
            formatTime: function (time) {
                if (!time) return '';
                const timeStr = time.toString().padStart(4, '0');
                return `${timeStr.substring(0, 2)}:${timeStr.substring(2, 4)}`;
            }
        };
        
        // 페이지 로드 시 실행
        document.addEventListener('DOMContentLoaded', function () {
            // 세션 스토리지에서 선택된 회원 정보 가져오기
            const memberJson = sessionStorage.getItem('selectedMember');
            
            if (!memberJson) {
                // 선택된 회원이 없으면 회원 선택 페이지로 이동
                alert('선택된 회원이 없습니다. 회원을 먼저 선택해주세요.');
                window.location.href = 'member-select.html';
                return;
            }
            
            // 회원 정보 파싱
            selectedMember = JSON.parse(memberJson);
            
            // 회원 정보 표시
            displayMemberInfo();

            // 세션 스토리지에서 신청한 클래스 정보 가져오기
            loadAppliedClasses();

            // 날짜 입력 필드 초기화
            initDateInput();
            
            // 활동 데이터 로드
            loadPlanData();

            // 필터 버튼 이벤트 리스너 추가
            setupFilterButtons();

            // 모달 버튼 초기화
            setupModalButtons();

            // 회원 변경 버튼 클릭 이벤트 리스너 추가
            const changeMemberBtn = document.getElementById('change-member-btn');
            if (changeMemberBtn) {
                changeMemberBtn.addEventListener('click', changeMember);
            }

            // 모달 닫기 버튼 이벤트 리스너 추가
            const modalCloseBtn = document.getElementById('modal-close');
            if (modalCloseBtn) {
                modalCloseBtn.addEventListener('click', closeModal);
            }

            // 신청 취소 버튼 이벤트 리스너 추가
            const cancelBtn = document.getElementById('cancel-button');
            if (cancelBtn) {
                cancelBtn.addEventListener('click', closeModal);
            }

            // 신청하기 버튼 이벤트 리스너 추가
            const applyBtn = document.getElementById('apply-button');
            if (applyBtn) {
                applyBtn.addEventListener('click', applyActivity);
            }

            // 최종 모달 닫기 버튼 이벤트 리스너 추가
            const finalModalCloseBtn = document.getElementById('final-modal-close');
            if (finalModalCloseBtn) {
                finalModalCloseBtn.addEventListener('click', function () {
                    document.getElementById('final-confirm-modal').classList.remove('active');
                });
            }

            // 최종 취소 버튼 이벤트 리스너 추가
            const finalCancelBtn = document.querySelector('.final-confirm-btn.cancel');
            if (finalCancelBtn) {
                finalCancelBtn.addEventListener('click', function () {
                    document.getElementById('final-confirm-modal').classList.remove('active');
                });
            }

            // 최종 신청 버튼 이벤트 리스너 추가
            const finalSubmitBtn = document.querySelector('.final-confirm-btn.submit');
            if (finalSubmitBtn) {
                finalSubmitBtn.addEventListener('click', function () {
                    alert('최종 신청이 완료되었습니다!');
                    document.getElementById('final-confirm-modal').classList.remove('active');
                });
            }

            // 모든 클래스 완료 모달 닫기 버튼 이벤트 리스너 추가
            const completeModalCloseBtn = document.getElementById('complete-modal-close');
            if (completeModalCloseBtn) {
                completeModalCloseBtn.addEventListener('click', closeCompleteModal);
            }

            // 모든 클래스 완료 모달 계속 선택하기 버튼 이벤트 리스너 추가
            const completeModalSecondaryBtn = document.getElementById('complete-modal-btn-secondary');
            if (completeModalSecondaryBtn) {
                completeModalSecondaryBtn.addEventListener('click', closeCompleteModal);
            }
        });

        // 날짜 입력 필드 초기화
        function initDateInput() {
            const dateInput = document.getElementById('date-input');
            if (!dateInput) return;

            // 세션 스토리지에서 저장된 날짜 확인
            const savedDate = sessionStorage.getItem('selectedDate');

            let formattedDate;
            if (savedDate) {
                // 저장된 날짜가 있으면 사용
                formattedDate = savedDate;
            } else {
                // 없으면 오늘 날짜 사용
                const today = new Date();
                const year = today.getFullYear();
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const day = String(today.getDate()).padStart(2, '0');
                formattedDate = `${year}-${month}-${day}`;

                // 세션 스토리지에 오늘 날짜 저장
                sessionStorage.setItem('selectedDate', formattedDate);
            }

            // 입력 필드에 날짜 설정
            dateInput.value = formattedDate;

            // 날짜 변경 이벤트 리스너 추가
            dateInput.addEventListener('change', handleDateChange);
        }

        // 날짜 변경 처리
        function handleDateChange(event) {
            // 입력된 날짜 가져오기
            const dateValue = event.target.value;
            if (!dateValue) return;

            // 세션 스토리지에 선택된 날짜 저장 (다른 페이지와 공유)
            sessionStorage.setItem('selectedDate', dateValue);

            // 날짜 객체로 변환
            selectedDate = new Date(dateValue);

            // 로그 출력 (실제 구현 시에는 필요에 따라 다른 작업 수행)
            console.log('선택된 날짜:', selectedDate);

            // 날짜에 따라 데이터를 다시 로드하는 코드를 추가할 수 있습니다.
            // loadDataForDate(selectedDate);

            // 예시: 알림 표시
            const message = document.createElement('div');
            message.className = 'success-message';
            message.textContent = `${dateValue} 일자의 활동을 표시합니다.`;
            message.style.backgroundColor = '#2196f3';
            document.body.appendChild(message);

            // 메시지 표시 및 제거
            setTimeout(() => {
                message.classList.add('show');

                setTimeout(() => {
                    message.classList.remove('show');

                    setTimeout(() => {
                        document.body.removeChild(message);
                    }, 300);
                }, 2000);
            }, 10);
        }
        
        // 회원 정보 표시
        function displayMemberInfo() {
            if (!selectedMember) return;
            
            // 생년월일 포맷팅 (YYYYMMDD → YYYY-MM-DD)
            const birthDate = selectedMember.birth ? 
                `${selectedMember.birth.substring(0, 4)}-${selectedMember.birth.substring(4, 6)}-${selectedMember.birth.substring(6, 8)}` : 
                '정보 없음';
            
            // 회원 정보 업데이트
            document.getElementById('member-name').innerHTML = `${selectedMember.name} <span class="greeting">어르신 즐거운하루되세요</span>`;
            document.getElementById('member-details').innerHTML = `
                <div class="member-number">회원번호: ${selectedMember.number}</div>
                <div class="member-birth">생년월일: ${birthDate}</div>
            `;
        }

        // 신청한 클래스 정보 불러오기
        function loadAppliedClasses() {
            if (!selectedMember) return;

            // 세션 스토리지에서 신청한 클래스 불러오기
            const key = `appliedClasses_${selectedMember.number}`;
            const savedClasses = sessionStorage.getItem(key);

            if (savedClasses) {
                appliedClasses = JSON.parse(savedClasses);
                updateAppliedClassesDisplay();
            }
        }

        // 신청한 클래스 정보 저장하기
        function saveAppliedClasses() {
            if (!selectedMember) return;

            // 세션 스토리지에 신청한 클래스 저장
            const key = `appliedClasses_${selectedMember.number}`;
            sessionStorage.setItem(key, JSON.stringify(appliedClasses));
        }

        // 신청한 클래스 표시 업데이트
        function updateAppliedClassesDisplay() {
            const container = document.getElementById('applied-class-tags');
            if (!container) return;

            // 컨테이너 비우기
            container.innerHTML = '';

            // 신청한 클래스가 없는 경우
            if (appliedClasses.length === 0) {
                container.innerHTML = '<span class="empty-applied">아직 신청한 클래스가 없습니다.</span>';
                return;
            }

            // 신청한 클래스별로 태그 생성
            appliedClasses.forEach((classItem, index) => {
                const tag = document.createElement('div');
                tag.className = 'applied-class-tag';

                // 시간을 기준으로 차수 결정
                let classNumber = CLASS_TIMES.getLabelByTime(classItem.startTime);

                tag.innerHTML = `
                    <span class="applied-class-tag-time">${classNumber}</span>
                    <span class="applied-class-tag-title">${classItem.title}</span>
                    <span class="applied-class-tag-delete" data-index="${index}" onclick="removeAppliedClass(${index}); event.stopPropagation();">&times;</span>
                `;

                container.appendChild(tag);
            });
        }

        // 신청한 클래스 제거
        function removeAppliedClass(index) {
            if (index >= 0 && index < appliedClasses.length) {
                // 사용자 확인
                if (confirm(`${appliedClasses[index].title} 클래스 신청을 취소하시겠습니까?`)) {
                    // 배열에서 해당 항목 제거
                    appliedClasses.splice(index, 1);

                    // 저장 및 표시 업데이트
                    saveAppliedClasses();
                    updateAppliedClassesDisplay();

                    // 취소 성공 메시지
                    const message = document.createElement('div');
                    message.className = 'success-message';
                    message.style.backgroundColor = '#ff9800';
                    message.textContent = '클래스 신청이 취소되었습니다.';
                    document.body.appendChild(message);

                    // 메시지 표시 후 일정 시간 후 제거
                    setTimeout(() => {
                        message.classList.add('show');

                        setTimeout(() => {
                            message.classList.remove('show');

                            setTimeout(() => {
                                document.body.removeChild(message);
                            }, 300);
                        }, 3000);
                    }, 10);
                }
            }
        }
        
        // 샘플 데이터 로드 (테스트용)
        function loadSampleData() {
            // 샘플 계획 데이터 객체 형태로 구조화
            const classesData = {
                // 1차 클래스 (9:00 - 10:30)
                first: [
                    { id: "P001", title: "아침 체조", startTime: "0900", endTime: "1030", instructor: "김선생", capacity: "15", category: "건강", location: "실내 운동실", backgroundImage: "https://newsimg.hankookilbo.com/cms/articlerelease/2021/02/05/6e089997-44db-4f18-97dd-ee337f9a5810.jpg" },
                    { id: "P002", title: "영어 회화", startTime: "0900", endTime: "1030", instructor: "박선생", capacity: "10", category: "교육", location: "어학실", backgroundImage: "https://cdn.pixabay.com/photo/2016/11/14/03/38/achieve-1822503_1280.jpg" },
                    { id: "P003", title: "요가 교실", startTime: "0900", endTime: "1030", instructor: "이선생", capacity: "8", category: "건강", location: "운동실", backgroundImage: "https://cdn.pixabay.com/photo/2016/11/18/15/32/yoga-1835026_1280.jpg" },
                    { id: "P004", title: "공예 활동", startTime: "0900", endTime: "1030", instructor: "최선생", capacity: "12", category: "취미", location: "공예실", backgroundImage: "https://cdn.pixabay.com/photo/2019/02/23/11/58/craft-4016321_1280.jpg" },
                    { id: "P005", title: "독서 시간", startTime: "0900", endTime: "1030", instructor: "정선생", capacity: "10", category: "문화", location: "도서실", backgroundImage: "https://cdn.pixabay.com/photo/2016/03/26/22/21/books-1281581_1280.jpg" },
                    { id: "P026", title: "가드닝 기초", startTime: "0900", endTime: "1030", instructor: "심선생", capacity: "8", category: "취미", location: "화단", backgroundImage: "https://cdn.pixabay.com/photo/2014/07/23/10/07/garden-work-400609_1280.jpg" },
                    { id: "P027", title: "명상 및 호흡", startTime: "0900", endTime: "1030", instructor: "도선생", capacity: "12", category: "건강", location: "명상실", backgroundImage: "https://cdn.pixabay.com/photo/2016/11/18/16/16/adult-1835463_1280.jpg" }
                ],

                // 2차 클래스 (10:30 - 12:00)
                second: [
                    { id: "P006", title: "독서 토론", startTime: "1030", endTime: "1200", instructor: "윤선생", capacity: "12", category: "문화", location: "도서실", backgroundImage: "https://cdn.pixabay.com/photo/2016/11/29/09/38/adult-1868699_1280.jpg" },
                    { id: "P007", title: "정보 교육", startTime: "1030", endTime: "1200", instructor: "한선생", capacity: "8", category: "교육", location: "컴퓨터실", backgroundImage: "https://cdn.pixabay.com/photo/2016/11/19/14/00/code-1839406_1280.jpg" },
                    { id: "P008", title: "원예 활동", startTime: "1030", endTime: "1200", instructor: "송선생", capacity: "15", category: "취미", location: "원예실", backgroundImage: "https://cdn.pixabay.com/photo/2016/11/18/14/03/hands-1834443_1280.jpg" }
                ],

                // 3차 클래스 (13:00 - 14:30)
                third: [
                    { id: "P011", title: "미술 활동", startTime: "1300", endTime: "1430", instructor: "조선생", capacity: "10", category: "취미", location: "미술실", backgroundImage: "https://cdn.pixabay.com/photo/2017/07/03/20/17/abstract-2468874_1280.jpg" },
                    { id: "P012", title: "음악 감상", startTime: "1300", endTime: "1430", instructor: "백선생", capacity: "8", category: "문화", location: "음악실", backgroundImage: "https://cdn.pixabay.com/photo/2015/05/07/11/02/guitar-756326_1280.jpg" },
                    { id: "P013", title: "체력 단련", startTime: "1300", endTime: "1430", instructor: "황선생", capacity: "12", category: "건강", location: "체육관", backgroundImage: "https://cdn.pixabay.com/photo/2015/07/02/10/23/training-828741_1280.jpg" },
                    { id: "P014", title: "댄스 교실", startTime: "1300", endTime: "1430", instructor: "서선생", capacity: "15", category: "건강", location: "댄스실", backgroundImage: "https://cdn.pixabay.com/photo/2018/01/28/10/08/ballet-3113318_1280.jpg" },
                    { id: "P015", title: "스마트폰 활용", startTime: "1300", endTime: "1430", instructor: "신선생", capacity: "10", category: "교육", location: "디지털실", backgroundImage: "https://cdn.pixabay.com/photo/2017/01/05/04/51/apple-1953331_1280.jpg" },
                    { id: "P030", title: "탁구 교실", startTime: "1300", endTime: "1430", instructor: "문선생", capacity: "8", category: "여가", location: "체육관", backgroundImage: "https://cdn.pixabay.com/photo/2019/05/21/05/07/table-tennis-4217625_1280.jpg" },
                    { id: "P031", title: "외국어 기초", startTime: "1300", endTime: "1430", instructor: "박선생", capacity: "10", category: "교육", location: "어학실", backgroundImage: "https://cdn.pixabay.com/photo/2015/07/19/10/00/school-work-851328_1280.jpg" }
                ],

                // 4차 클래스 (14:30 - 16:00)
                fourth: [
                    { id: "P016", title: "셀프 메이크업", startTime: "1430", endTime: "1600", instructor: "문선생", capacity: "10", category: "자기관리", location: "미용실", backgroundImage: "https://cdn.pixabay.com/photo/2016/10/22/21/24/woman-1761554_1280.jpg" },
                    { id: "P017", title: "컴퓨터 기초", startTime: "1430", endTime: "1600", instructor: "양선생", capacity: "8", category: "교육", location: "컴퓨터실", backgroundImage: "https://cdn.pixabay.com/photo/2018/01/17/20/22/analytics-3088958_1280.jpg" },
                    { id: "P018", title: "보드게임", startTime: "1430", endTime: "1600", instructor: "전선생", capacity: "12", category: "여가", location: "휴게실", backgroundImage: "https://cdn.pixabay.com/photo/2016/09/08/17/25/checkers-1655093_1280.jpg" },
                    { id: "P019", title: "외국어 교실", startTime: "1430", endTime: "1600", instructor: "고선생", capacity: "10", category: "교육", location: "어학실", backgroundImage: "https://cdn.pixabay.com/photo/2017/07/31/11/44/laptop-2557571_1280.jpg" },
                    { id: "P020", title: "건강 체조", startTime: "1430", endTime: "1600", instructor: "남선생", capacity: "15", category: "건강", location: "체육관", backgroundImage: "https://cdn.pixabay.com/photo/2017/02/24/10/31/matcha-2094584_1280.jpg" }
                ],

                // 5차 클래스 (16:00 - 17:30)
                fifth: [
                    { id: "P021", title: "요리 교실", startTime: "1600", endTime: "1730", instructor: "오선생", capacity: "10", category: "자립", location: "조리실", backgroundImage: "https://cdn.pixabay.com/photo/2017/12/09/08/18/pizza-3007395_1280.jpg" },
                    { id: "P022", title: "영화 감상", startTime: "1600", endTime: "1730", instructor: "성선생", capacity: "15", category: "문화", location: "영상실", backgroundImage: "https://cdn.pixabay.com/photo/2017/11/24/10/43/admission-2974645_1280.jpg" },
                    { id: "P023", title: "명상 시간", startTime: "1600", endTime: "1730", instructor: "류선생", capacity: "8", category: "건강", location: "명상실", backgroundImage: "https://cdn.pixabay.com/photo/2017/03/26/21/54/yoga-2176668_1280.jpg" },
                    { id: "P024", title: "사진 촬영", startTime: "1600", endTime: "1730", instructor: "지선생", capacity: "12", category: "취미", location: "야외", backgroundImage: "https://cdn.pixabay.com/photo/2014/10/30/20/13/sunrise-509826_1280.jpg" },
                    { id: "P025", title: "퀴즈 대회", startTime: "1600", endTime: "1730", instructor: "안선생", capacity: "15", category: "여가", location: "세미나실", backgroundImage: "https://cdn.pixabay.com/photo/2017/01/26/01/19/live-2009693_1280.jpg" }
                ]
            };

            // 객체 데이터를 배열로 변환하여 displayTimeSection 함수에 전달
            const convertToArray = (classItems) => {
                return classItems.map(item => [
                    item.id,
                    item.title,
                    item.startTime,
                    item.endTime,
                    item.instructor,
                    item.capacity,
                    item.category,
                    item.location,
                    item.backgroundImage // 배경 이미지 URL도 배열에 추가
                ]);
            };

            // 차수별로 데이터 표시
            displayTimeSection(CLASS_TIMES.TITLES[0], convertToArray(classesData.first));
            displayTimeSection(CLASS_TIMES.TITLES[1], convertToArray(classesData.second));
            displayTimeSection(CLASS_TIMES.TITLES[2], convertToArray(classesData.third));
            displayTimeSection(CLASS_TIMES.TITLES[3], convertToArray(classesData.fourth));
            displayTimeSection(CLASS_TIMES.TITLES[4], convertToArray(classesData.fifth));
        }

        // 시간대별 섹션 표시
        function displayTimeSection(title, activities) {
            const container = document.getElementById('products-container');
            if (!container) return;

            // 시간대별 클래스 ID 추출 (1차, 2차, 3차...)
            const classNum = title.charAt(0);

            // 시간대 섹션 컨테이너 생성
            const sectionContainer = document.createElement('div');
            sectionContainer.className = 'time-section';
            sectionContainer.id = `class${classNum}-section`;

            // 섹션 타이틀 생성
            const sectionTitle = document.createElement('h2');
            sectionTitle.className = 'time-section-title';
            sectionTitle.id = `time-title-${classNum}`;
            sectionTitle.textContent = title;

            // 카드 컨테이너 생성
            const cardsContainer = document.createElement('div');
            cardsContainer.className = 'cards-container';
            cardsContainer.id = `cards-container-${classNum}`;

            // 시간대 섹션에 타이틀 추가
            sectionContainer.appendChild(sectionTitle);

            // 시간대 섹션에 카드 컨테이너 추가
            sectionContainer.appendChild(cardsContainer);

            // 활동 카드 추가
            updateProductCards(activities, cardsContainer);

            // 메인 컨테이너에 시간대 섹션 추가
            container.appendChild(sectionContainer);
        }
        
        // 활동 카드 업데이트 함수
        function updateProductCards(activities, targetContainer = null) {
            const container = targetContainer || document.getElementById('products-container');
            if (!container) return;
            
            // 컨테이너가 직접 지정되지 않았고 기존 컨테이너를 사용하는 경우에만 비움
            if (!targetContainer) {
            container.innerHTML = '';
            }
            
            // 활동별로 카드 생성
            activities.forEach(activity => {
                // 배열 형식 데이터 처리
                let id, title, startTime, endTime, instructor, capacity, lifeArea, location, backgroundImage;

                if (Array.isArray(activity)) {
                    id = activity[0]; // ID
                    title = activity[1] || '제목 없음'; // 제목
                    startTime = activity[2] || ''; // 시작 시간
                    endTime = activity[3] || ''; // 종료 시간
                    instructor = activity[4] || ''; // 담당자
                    capacity = activity[5] || ''; // 정원
                    lifeArea = activity[6] || ''; // 생활영역
                    location = activity[7] || ''; // 장소
                    backgroundImage = activity[8] || 'https://newsimg.hankookilbo.com/cms/articlerelease/2021/02/05/6e089997-44db-4f18-97dd-ee337f9a5810.jpg'; // 배경 이미지
                } else if (typeof activity === 'object') {
                    // 객체 형식 데이터 처리 
                    id = activity.id || '';
                    title = activity.title || '제목 없음';
                    startTime = activity.startTime || '';
                    endTime = activity.endTime || '';
                    instructor = activity.instructor || '';
                    capacity = activity.capacity || '';
                    lifeArea = activity.category || '';
                    location = activity.location || '';
                    backgroundImage = activity.backgroundImage || 'https://newsimg.hankookilbo.com/cms/articlerelease/2021/02/05/6e089997-44db-4f18-97dd-ee337f9a5810.jpg';
                }
                
                // 시간 포맷팅 (HHMM → HH:MM)
                const formattedStartTime = startTime ? 
                    `${startTime.substring(0, 2)}:${startTime.substring(2, 4)}` : '';
                const formattedEndTime = endTime ? 
                    `${endTime.substring(0, 2)}:${endTime.substring(2, 4)}` : '';
                
                // 카드 ID 생성
                const cardId = `card-${id}`;

                // HTML로 카드 생성
                const cardHtml = `
                        <div id="${cardId}" class="product-card" 
                            data-id="${id}" 
                            data-title="${title}" 
                            data-start="${startTime}" 
                            data-end="${endTime}" 
                            data-instructor="${instructor}" 
                            data-capacity="${capacity}"
                            data-life-area="${lifeArea}"
                            data-location="${location}"
                            data-background="${backgroundImage}">
                        <div class="card-front">
                            ${lifeArea ? `<div class="ribbon">${lifeArea}</div>` : ''}
                            <div class="product-info">
                                <div class="product-title">${title}</div>
                                    <div class="product-instructor">담당: ${instructor}</div>
                                    <div class="product-location">장소: ${location}</div>
                                    <div class="product-capacity">정원: ${capacity}명</div>
                                    <div class="product-description">이 프로그램은 ${lifeArea} 생활영역의 활동입니다. ${formattedStartTime}부터 ${formattedEndTime}까지 진행됩니다.</div>
                            </div>
                        </div>
                            <div class="card-back" style="background-image: url('${backgroundImage}')">
                                <div>
                            <h3>${title}</h3>
                                </div>
                                <button class="apply-class-btn" id="apply-btn-${id}">신청하기</button>
                        </div>
                    </div>
                `;
                
                // HTML 추가
                container.insertAdjacentHTML('beforeend', cardHtml);

                // 방금 추가한 카드 찾기
                const card = container.lastElementChild;
            
            // 카드 클릭 이벤트 추가
                card.addEventListener('click', handleCardClick);

                // 신청 버튼 클릭 이벤트 추가
                const applyBtn = card.querySelector('.apply-class-btn');
                if (applyBtn) {
                    applyBtn.addEventListener('click', function (event) {
                        event.stopPropagation(); // 카드 클릭 이벤트 방지
                        openConfirmModal(card);
                    });
                }
            });
        }

        // 카드 클릭 이벤트 핸들러
        function handleCardClick(event) {
            // 버튼 클릭 시 카드 클릭 이벤트 무시
            if (event.target.tagName === 'BUTTON') return;

            // 현재 클릭한 카드
            const clickedCard = this;

            // 현재 클릭한 카드가 이미 활성화 상태인지 확인
            const isClickedCardActive = clickedCard.classList.contains('active');

            // 활성화된 모든 카드 찾기
            const allCards = document.querySelectorAll('.product-card');
            const activeCard = document.querySelector('.product-card.active');

            // 오버레이 가져오기 또는 생성
            let overlay = document.querySelector('.card-overlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.className = 'card-overlay';
                document.body.appendChild(overlay);

                // 오버레이 클릭 이벤트 리스너 추가
                overlay.addEventListener('click', function () {
                    // 활성화된 카드 찾아서 비활성화
                    const activeCard = document.querySelector('.product-card.active');
                    if (activeCard) {
                        activeCard.classList.remove('active');

                        // 모든 카드의 inactive 클래스 제거
            document.querySelectorAll('.product-card').forEach(card => {
                            card.classList.remove('inactive');
                        });

                        // 오버레이 비활성화
                        overlay.classList.remove('active');
                    }
                });
            }

            // 화면 너비 확인 (768px 이상인 경우에만 중앙 배치 효과 적용)
            const isDesktop = window.innerWidth > 768;

            // 1. 현재 활성화된 카드가 있고, 클릭한 카드가 활성화된 카드가 아니라면
            if (activeCard && activeCard !== clickedCard) {
                // 기존 활성화 카드 비활성화
                activeCard.classList.remove('active');

                // 모든 카드의 inactive 클래스 제거
                allCards.forEach(card => {
                    card.classList.remove('inactive');
                });

                // 클릭한 카드를 제외한 다른 모든 카드를 inactive로 설정
                allCards.forEach(card => {
                    if (card !== clickedCard) {
                        card.classList.add('inactive');
                    }
                });

                // 크기에 따라 카드 활성화 방식 변경
                if (isDesktop) {
                    requestAnimationFrame(() => {
                        clickedCard.classList.add('active');
                        overlay.classList.add('active');
                        });
                    } else {
                    requestAnimationFrame(() => {
                        clickedCard.classList.add('active');
                    });
                }
            }
            // 2. 클릭한 카드가 이미 활성화된 상태라면
            else if (isClickedCardActive) {
                // 클릭한 카드 비활성화
                clickedCard.classList.remove('active');

                // 모든 카드의 inactive 클래스 제거
                allCards.forEach(card => {
                    card.classList.remove('inactive');
                });

                // 오버레이 비활성화
                overlay.classList.remove('active');
            }
            // 3. 활성화된 카드가 없고, 클릭한 카드가 활성화되지 않은 상태라면
            else {
                // 클릭한 카드를 제외한 다른 모든 카드를 inactive로 설정
                allCards.forEach(card => {
                    if (card !== clickedCard) {
                        card.classList.add('inactive');
                    }
                });

                // 크기에 따라 카드 활성화 방식 변경
                if (isDesktop) {
                        requestAnimationFrame(() => {
                        clickedCard.classList.add('active');
                        overlay.classList.add('active');
                    });
                } else {
                    requestAnimationFrame(() => {
                        clickedCard.classList.add('active');
                    });
                }
            }
        }

        // Google Apps Script에서 계획 데이터 로드
        function loadPlanData() {
            // Google Apps Script 환경에 있는지 확인
            if (typeof google !== 'undefined' && google.script) {
                showLoading(true);

                // Google Apps Script로 데이터 요청
                google.script.run
                    .withSuccessHandler(function (result) {
                        showLoading(false);
                        try {
                            // JSON 데이터 파싱
                            const data = JSON.parse(result);

                            // 성공 여부 확인
                            if (data.success) {
                                // 클래스 데이터 가져오기
                                const classes = data.data || [];

                                // 차수별로 클래스 분류
                                const classesByTime = {
                                    first: [],
                                    second: [],
                                    third: [],
                                    fourth: [],
                                    fifth: []
                                };

                                // 클래스 분류
                                classes.forEach(classData => {
                                    const startTime = classData[2]; // 시작 시간
                                    if (startTime) {
                                        // 시작 시간으로 차수 결정
                                        const timeSlot = CLASS_TIMES.getSlotByTime(startTime);

                                        // 분류에 추가
                                        if (timeSlot && classesByTime[timeSlot]) {
                                            classesByTime[timeSlot].push(classData);
                                        }
                                    }
                                });

                                // 각 차수별로 표시
                                for (let i = 0; i < CLASS_TIMES.TITLES.length; i++) {
                                    const timeSlotKey = CLASS_TIMES.SLOTS[i];
                                    const classes = classesByTime[timeSlotKey] || [];

                                    displayTimeSection(CLASS_TIMES.TITLES[i], classes);
                                }
                            } else {
                                // 오류 메시지 표시 및 샘플 데이터 사용
                                alert(data.message || '클래스 정보를 불러오는 데 실패했습니다.');
                                loadSampleData();
                            }
                        } catch (error) {
                            // JSON 파싱 오류 시 샘플 데이터 사용
                            console.error('데이터 처리 중 오류 발생:', error);
                            loadSampleData();
                        }
                    })
                    .withFailureHandler(function (error) {
                        // 요청 실패 시 샘플 데이터 사용
                        showLoading(false);
                        console.error('클래스 정보 요청 실패:', error);
                        loadSampleData();
                    })
                    .getClassPlans(selectedMember ? selectedMember.number : '', datePicker.value);
            } else {
                // Google Apps Script 환경이 아니면 샘플 데이터 사용
                loadSampleData();
            }
        }
        
        // 확인 모달 열기
        function openConfirmModal(card) {
            // 카드에서 데이터 추출
            const id = card.getAttribute('data-id');
            const title = card.getAttribute('data-title');
            const startTime = card.getAttribute('data-start');
            const endTime = card.getAttribute('data-end');
            const instructor = card.getAttribute('data-instructor');
            const lifeArea = card.getAttribute('data-life-area');
            const location = card.getAttribute('data-location');
            const capacity = card.getAttribute('data-capacity');

            // 시간 포맷팅
            const formattedStartTime = CLASS_TIMES.formatTime(startTime);
            const formattedEndTime = CLASS_TIMES.formatTime(endTime);

            // 활동 정보 저장 (신청 처리에 사용)
            selectedActivity = {
                id: id,
                title: title,
                startTime: startTime,
                endTime: endTime,
                instructor: instructor,
                lifeArea: lifeArea,
                location: location,
                capacity: capacity
            };

            // 시간대 차수 확인
            const classType = CLASS_TIMES.getLabelByTime(startTime);
            
            // 모달 내용 업데이트
            document.getElementById('confirm-activity-name').textContent = title;
            document.getElementById('confirm-time').textContent = `${formattedStartTime} ~ ${formattedEndTime}`;
            document.getElementById('confirm-instructor').textContent = instructor;
            
            // 회원 정보 업데이트
            if (selectedMember) {
                document.getElementById('confirm-member-name').textContent = selectedMember.name;
            }

            // 모달 열기
            const modal = document.getElementById('confirm-modal');
            if (modal) modal.classList.add('active');
        }
        
        // 모달 닫기
        function closeModal() {
            const modal = document.getElementById('confirm-modal');
            if (modal) {
                modal.classList.remove('active');

                // 모달을 닫은 후 선택된 활동 정보 초기화
                selectedActivity = null;
            }
        }

        // 활동 신청 처리
        function applyActivity() {
            console.log('applyActivity 함수 호출됨');
            if (!selectedActivity) {
                alert('선택된 활동이 없습니다.');
                return;
            }
            
            // 날짜 값 가져오기
            const datePicker = document.getElementById('date-input');
            const activityDate = datePicker?.value || getCurrentDateString();
            
            // 신청 데이터 준비
            const applicationData = [
                selectedMember.number, // 회원번호
                selectedMember.name,   // 회원이름
                selectedActivity.id,   // 활동 ID
                selectedActivity.title, // 활동 제목
                activityDate,          // 신청 날짜
                selectedActivity.startTime, // 시작 시간
                selectedActivity.endTime,   // 종료 시간
                selectedActivity.instructor, // 담당자
                selectedActivity.lifeArea    // 생활영역
            ];
            
            // Google Apps Script 환경에서만 저장 진행
            if (typeof google !== 'undefined' && google.script) {
                showLoading(true);
                google.script.run
                    .withSuccessHandler(function (result) {
                        showLoading(false);
                        const data = JSON.parse(result);
                        if (data.success) {
                            // 신청한 클래스 목록에 추가
                            addAppliedClass(selectedActivity);
                            showSuccessMessage();
                            closeModal();

                            // 다음 빈 클래스로 이동
                            moveToNextEmptyClass(selectedActivity);
                        } else {
                            alert(data.message || '신청 중 오류가 발생했습니다.');
                        }
                    })
                    .withFailureHandler(function (error) {
                        showLoading(false);
                        alert('신청 중 오류가 발생했습니다: ' + error);
                    })
                    .saveApplicationData(applicationData);
            } else {
                // 샘플 환경 - 테스트 동작
                addAppliedClass(selectedActivity);
                showSuccessMessage();
                closeModal();

                // 다음 빈 클래스로 이동
                moveToNextEmptyClass(selectedActivity);
            }
        }

        // 현재 날짜를 YYYY-MM-DD 형식으로 반환
        function getCurrentDateString() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // 신청한 클래스 추가
        function addAppliedClass(activity) {
            // 같은 ID의 클래스가 있는지 확인
            const existingByIdIndex = appliedClasses.findIndex(item => item.id === activity.id);

            // 이미 같은 ID가 있으면 제거 (업데이트)
            if (existingByIdIndex >= 0) {
                appliedClasses.splice(existingByIdIndex, 1);
            } else {
                // 같은 차수의 다른 클래스가 있는지 확인
                const startTime = parseInt(activity.startTime);
                let classType = CLASS_TIMES.getLabelByTime(activity.startTime);

                // 같은 차수에 이미 클래스가 있는지 확인
                if (classType !== '기타') {
                    const existingByTimeIndex = appliedClasses.findIndex(item =>
                        CLASS_TIMES.getLabelByTime(item.startTime) === classType
                    );

                    // 같은 차수에 기존 클래스가 있으면 제거하고 메시지 표시
                    if (existingByTimeIndex >= 0) {
                        const removedClass = appliedClasses[existingByTimeIndex];
                        appliedClasses.splice(existingByTimeIndex, 1);

                        // 사용자에게 알림 표시
                        const warningMessage = document.createElement('div');
                        warningMessage.className = 'success-message';
                        warningMessage.style.backgroundColor = '#ff9800';
                        warningMessage.textContent = `${classType} 시간대의 기존 신청 (${removedClass.title})이 취소되었습니다.`;
                        document.body.appendChild(warningMessage);

                        // 메시지 표시 및 제거
                        setTimeout(() => {
                            warningMessage.classList.add('show');

                            setTimeout(() => {
                                warningMessage.classList.remove('show');

                                setTimeout(() => {
                                    document.body.removeChild(warningMessage);
                                }, 300);
                            }, 3000);
                        }, 10);
                    }
                }
            }

            // 새로 추가
            appliedClasses.push({
                id: activity.id,
                title: activity.title,
                startTime: activity.startTime,
                endTime: activity.endTime,
                instructor: activity.instructor,
                lifeArea: activity.lifeArea
            });

            // 시작 시간순으로 정렬
            appliedClasses.sort((a, b) => a.startTime.localeCompare(b.startTime));

            // 저장 및 표시 업데이트
            saveAppliedClasses();
            updateAppliedClassesDisplay();
        }
        
        // 성공 메시지 표시
        function showSuccessMessage() {
            const message = document.getElementById('success-message');
            message.classList.add('show');
            
            // 3초 후 메시지 숨기기
            setTimeout(() => {
                message.classList.remove('show');
            }, 3000);
        }
        
        // 회원 변경
        function changeMember() {
            // 페이드 아웃 효과 적용 후 페이지 이동
            document.body.classList.add('fade-out');
            setTimeout(() => {
                // 회원 선택 페이지로 이동
                window.location.href = 'member-select.html';
            }, 400);
        }
        
        // 로딩 표시/숨김 기능
        function showLoading(isShow) {
            const loadingElement = document.getElementById('loading');
            if (loadingElement) {
                loadingElement.style.display = isShow ? 'flex' : 'none';
            }
        }

        // 필터 버튼 설정
        function setupFilterButtons() {
            const filterButtons = document.querySelectorAll('.filter-button');
            const productsContainer = document.getElementById('products-container');

            filterButtons.forEach(button => {
                button.addEventListener('click', function () {
                    // 모든 버튼에서 활성 클래스 제거
                    filterButtons.forEach(btn => btn.classList.remove('active'));

                    // 현재 버튼에 활성 클래스 추가
                    this.classList.add('active');

                    // 필터 값 가져오기
                    const filter = this.getAttribute('data-filter');

                    // 필터에 따라 섹션 표시/숨김 처리
                    if (filter === 'all') {
                        // 전체 보기
                        productsContainer.classList.add('all-visible');
                    } else {
                        // 특정 차수만 보기
                        productsContainer.classList.remove('all-visible');

                        // 모든 섹션 숨기기
                        document.querySelectorAll('.time-section').forEach(section => {
                            section.classList.remove('visible');
                        });

                        // 선택된 섹션만 보이기
                        const selectedSection = document.getElementById(`${filter}-section`);
                        if (selectedSection) {
                            selectedSection.classList.add('visible');
                        }
                    }
                });
            });
        }

        // 다음 빈 클래스로 이동 (수정)
        function moveToNextEmptyClass(currentActivity) {
            console.log('moveToNextEmptyClass 함수 호출됨', currentActivity);

            // 먼저 모든 카드의 비활성화 상태 해제
            resetAllCards();

            // 페이지 상단으로 스크롤
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // 미신청 클래스 여부 확인 (유효한 차수만)
            const availableClasses = checkAvailableClasses();
            console.log('사용 가능한 클래스:', availableClasses);

            // 미신청 클래스가 없으면 완료 모달 표시
            if (availableClasses.length === 0) {
                console.log('모든 클래스 신청 완료, 모달 표시');
                openCompleteModal();
                return;
            }

            // currentActivity가 null이거나 정의되지 않은 경우 처리
            if (!currentActivity || !currentActivity.startTime) {
                if (availableClasses.length > 0) {
                    // 첫 번째 사용 가능한 클래스로 스크롤
                    setTimeout(() => {
                        scrollToClass(availableClasses[0]);
                        clickFilterButton(availableClasses[0]);
                    }, 300);
                }
                return;
            }

            // 현재 활동의 시간대 찾기
            const currentClass = CLASS_TIMES.getLabelByTime(currentActivity.startTime);

            // 차수를 알 수 없으면 첫 번째 사용 가능한 클래스로 이동
            if (currentClass === '기타') {
                if (availableClasses.length > 0) {
                    setTimeout(() => {
                        scrollToClass(availableClasses[0]);
                        clickFilterButton(availableClasses[0]);
                    }, 300);
                }
                return;
            }

            // 현재 차수 이후의 첫 번째 빈 클래스 찾기
            let nextEmptyClass = findNextEmptyClass(currentClass);

            if (nextEmptyClass) {
                // 다음 빈 클래스가 있으면 해당 클래스로 스크롤 (지연 적용)
                setTimeout(() => {
                    scrollToClass(nextEmptyClass);
                    // 해당 클래스 섹션 표시하기 위해 필터 버튼 클릭
                    clickFilterButton(nextEmptyClass);
                }, 300);
            } else {
                // 다음 빈 클래스가 없으면 첫 번째 사용 가능한 클래스로 이동
                if (availableClasses.length > 0) {
                    setTimeout(() => {
                        scrollToClass(availableClasses[0]);
                        clickFilterButton(availableClasses[0]);
                    }, 300);
                } else {
                    // 모든 유효한 클래스를 신청했으면 완료 모달 표시
                    openCompleteModal();
                }
            }
        }

        // 특정 클래스로 스크롤
        function scrollToClass(classType) {
            const sectionId = `class${classType.charAt(0)}-section`;
            const section = document.getElementById(sectionId);

            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // 모든 카드의 비활성화 상태 해제
        function resetAllCards() {
            // 활성화된 카드 찾기
            const activeCard = document.querySelector('.product-card.active');
            if (activeCard) {
                activeCard.classList.remove('active');
            }

            // 비활성화된 카드 모두 활성화
            document.querySelectorAll('.product-card.inactive').forEach(card => {
                card.classList.remove('inactive');
            });

            // 오버레이 제거
            const overlay = document.querySelector('.card-overlay');
            if (overlay) {
                overlay.classList.remove('active');
            }
        }

        // 다음 빈 클래스 찾기
        function findNextEmptyClass(currentClass) {
            // 클래스 순서 정의
            const classOrder = ['1차', '2차', '3차', '4차', '5차'];
            const currentIndex = classOrder.indexOf(currentClass);

            // 이미 신청한 클래스의 차수들 목록
            const appliedClassTypes = [];
            appliedClasses.forEach(classItem => {
                const startTime = parseInt(classItem.startTime);
                if (startTime >= 900 && startTime < 1030) {
                    appliedClassTypes.push('1차');
                } else if (startTime >= 1030 && startTime < 1200) {
                    appliedClassTypes.push('2차');
                } else if (startTime >= 1300 && startTime < 1430) {
                    appliedClassTypes.push('3차');
                } else if (startTime >= 1430 && startTime < 1600) {
                    appliedClassTypes.push('4차');
                } else if (startTime >= 1600 && startTime < 1730) {
                    appliedClassTypes.push('5차');
                }
            });

            // 현재 클래스 다음부터 순서대로 확인
            for (let i = currentIndex + 1; i < classOrder.length; i++) {
                // 해당 차수를 아직 신청하지 않았으면 반환
                if (!appliedClassTypes.includes(classOrder[i])) {
                    return classOrder[i];
                }
            }

            // 다음 클래스가 없으면 현재 클래스 이전의 클래스들 확인
            for (let i = 0; i < currentIndex; i++) {
                if (!appliedClassTypes.includes(classOrder[i])) {
                    return classOrder[i];
                }
            }

            // 모든 클래스를 이미 신청했으면 null 반환
            return null;
        }

        // 필터 버튼 클릭 (프로그래밍적으로)
        function clickFilterButton(classType) {
            const filterButton = document.querySelector(`.filter-button[data-filter="class${classType.charAt(0)}"]`);

            if (filterButton) {
                filterButton.click();
            }
        }

        // 모든 클래스 완료 확인 모달 닫기
        function closeCompleteModal() {
            const modal = document.getElementById('complete-modal-overlay');
            if (modal) {
                modal.classList.remove('show');
            }
        }

        // 모든 신청 완료 처리
        function finalizeAllApplications() {
            // 실제 구현에서는 여기서 Google Apps Script를 사용하여 모든 신청 데이터를 한 번에 저장

            // 성공 메시지 표시
            const message = document.createElement('div');
            message.className = 'success-message';
            message.textContent = '모든 활동 신청이 완료되었습니다!';
            document.body.appendChild(message);

            // 메시지 표시
            setTimeout(() => {
                message.classList.add('show');

                setTimeout(() => {
                    message.classList.remove('show');

                    setTimeout(() => {
                        document.body.removeChild(message);

                        // 페이지 전환 효과 적용
                        document.body.classList.add('fade-out');

                        // 회원 선택 페이지로 이동
                        setTimeout(() => {
                            window.location.href = 'member-select.html';
                        }, 200);

                    }, 200);
                }, 1000);
            }, 10);

            // 모달 닫기
            closeCompleteModal();
        }

        // 모달 버튼 설정
        function setupModalButtons() {
            const submitBtn = document.getElementById('complete-modal-btn-primary');
            if (submitBtn) {
                submitBtn.addEventListener('click', finalizeAllApplications);
            }

            // 카드의 신청 버튼 이벤트 리스너 추가
            document.addEventListener('click', function (event) {
                // 이벤트 위임으로 신청 버튼 클릭 처리
                if (event.target.classList.contains('apply-class-btn')) {
                    event.stopPropagation(); // 버블링 방지
                    const card = event.target.closest('.product-card');
                    if (card) {
                        openConfirmModal(card);
                    }
                }
            });
        }

        // 모든 클래스 완료 확인 모달 열기
        function openCompleteModal() {
            console.log('openCompleteModal 함수 호출됨');

            // 신청한 클래스가 없으면 모달을 표시하지 않음
            if (!appliedClasses || appliedClasses.length === 0) {
                console.log('신청한 클래스가 없어 모달을 표시하지 않음');
                return;
            }

            // 컨테이너 가져오기
            const listContainer = document.getElementById('complete-classes-list');
            if (!listContainer) {
                console.error('complete-classes-list 요소를 찾을 수 없습니다.');
                return;
            }

            // 리스트 비우기
            listContainer.innerHTML = '';

            // 신청한 클래스 정렬 (차수 순)
            const sortedClasses = [...appliedClasses].sort((a, b) => {
                const startTimeA = parseInt(a.startTime);
                const startTimeB = parseInt(b.startTime);
                return startTimeA - startTimeB;
            });

            // 신청한 클래스 추가
            sortedClasses.forEach((classItem, index) => {
                // 차수 결정
                const classType = CLASS_TIMES.getLabelByTime(classItem.startTime);

                // 시간 포맷팅
                const formattedStartTime = CLASS_TIMES.formatTime(classItem.startTime);
                const formattedEndTime = CLASS_TIMES.formatTime(classItem.endTime);
                const formattedTime = `${formattedStartTime} ~ ${formattedEndTime}`;

                // 항목 HTML 생성
                const itemHTML = `
                        <div id="complete-item-${index}" class="complete-class-item">
                            <div id="class-badge-${index}" class="complete-class-badge">${classType}</div>
                            <div class="complete-class-content">
                                <div id="class-title-${index}" class="complete-class-title">${classItem.title}</div>
                                <div id="class-details-${index}" class="complete-class-instructor">
                                    ${formattedTime} | 담당: ${classItem.instructor} | 장소: ${classItem.location || '정보 없음'}
                                </div>
                            </div>
                        </div>
                    `;

                // 목록에 추가
                listContainer.insertAdjacentHTML('beforeend', itemHTML);
            });

            // 메시지 업데이트
            const messageElement = document.getElementById('complete-modal-message');
            if (messageElement && selectedMember) {
                messageElement.textContent = `${selectedMember.name} 회원님이 ${sortedClasses.length}개의 활동에 신청하셨습니다. 신청을 완료하시겠습니까?`;
            }

            // 모달 표시
            const modalElement = document.getElementById('complete-modal-overlay');
            if (modalElement) {
                modalElement.classList.add('show');
                console.log('완료 모달이 표시되었습니다.');
            } else {
                console.error('complete-modal-overlay 요소를 찾을 수 없습니다.');
            }
        }

        // 미신청 클래스 확인 (유효한 차수만 계산)
        function checkAvailableClasses() {
            // 클래스 순서 정의
            const classOrder = ['1차', '2차', '3차', '4차', '5차'];

            // 이미 신청한 클래스의 차수들 목록
            const appliedClassTypes = [];
            appliedClasses.forEach(classItem => {
                const classType = CLASS_TIMES.getLabelByTime(classItem.startTime);
                if (classType !== '기타') {
                    appliedClassTypes.push(classType);
                }
            });

            console.log('신청한 클래스 차수:', appliedClassTypes);

            // 각 차수에 표시할 수 있는 카드가 있는지 확인
            const availableClassTypes = [];
            classOrder.forEach(classType => {
                // 해당 차수를 아직 신청하지 않았고, 실제 카드가 있는지 확인
                if (!appliedClassTypes.includes(classType)) {
                    const sectionId = `class${classType.charAt(0)}-section`;
                    const section = document.getElementById(sectionId);

                    if (section) {
                        // 섹션 내에 표시 가능한 카드가 있는지 확인
                        const cards = section.querySelectorAll('.product-card:not(.inactive)');
                        if (cards.length > 0) {
                            availableClassTypes.push(classType);
                        }
                    }
                }
            });

            console.log('신청 가능한 클래스 차수:', availableClassTypes);
            return availableClassTypes;
        }

        // ESC 키 이벤트 리스너 추가
        document.addEventListener('keydown', function (event) {
            // ESC 키 (keyCode 27)가 눌렸을 때
            if (event.key === 'Escape' || event.keyCode === 27) {
                // 활성화된 카드가 있는지 확인
                const activeCard = document.querySelector('.product-card.active');
                if (activeCard) {
                    // 카드 초기화 함수 호출
                    resetAllCards();
                }
            }
        });
    </script>
</body>

</html> 
